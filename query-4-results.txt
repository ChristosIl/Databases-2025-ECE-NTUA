{
  "query_block": {
    "select_id": 1,
    "cost": 0.16002124,
    "filesort": {
      "sort_key": "coalesce(a.`name`,b.`name`), case when a.artist_id is not null then 'Artist' else 'Band' end",
      "temporary_table": {
        "nested_loop": [
          {
            "table": {
              "table_name": "r",
              "access_type": "ALL",
              "possible_keys": ["idx_rating_performance_id"],
              "loops": 1,
              "rows": 39,
              "cost": 0.0172118,
              "filtered": 100
            }
          },
          {
            "table": {
              "table_name": "p",
              "access_type": "eq_ref",
              "possible_keys": ["PRIMARY", "idx_performance_performs_id"],
              "key": "PRIMARY",
              "key_length": "4",
              "used_key_parts": ["performance_id"],
              "ref": ["festival_database.r.performance_id"],
              "loops": 39,
              "rows": 1,
              "cost": 0.03570236,
              "filtered": 100
            }
          },
          {
            "table": {
              "table_name": "pf",
              "access_type": "eq_ref",
              "possible_keys": ["PRIMARY"],
              "key": "PRIMARY",
              "key_length": "4",
              "used_key_parts": ["performs_id"],
              "ref": ["festival_database.p.performs_id"],
              "loops": 39,
              "rows": 1,
              "cost": 0.03570236,
              "filtered": 100
            }
          },
          {
            "table": {
              "table_name": "a",
              "access_type": "eq_ref",
              "possible_keys": ["PRIMARY", "idx_artist_id"],
              "key": "PRIMARY",
              "key_length": "4",
              "used_key_parts": ["artist_id"],
              "ref": ["festival_database.pf.artist_id"],
              "loops": 39,
              "rows": 1,
              "cost": 0.03570236,
              "filtered": 100,
              "attached_condition": "trigcond(trigcond(pf.artist_id is not null))"
            }
          },
          {
            "table": {
              "table_name": "b",
              "access_type": "eq_ref",
              "possible_keys": ["PRIMARY", "idx_band_id"],
              "key": "PRIMARY",
              "key_length": "4",
              "used_key_parts": ["band_id"],
              "ref": ["festival_database.pf.band_id"],
              "loops": 39,
              "rows": 1,
              "cost": 0.03570236,
              "filtered": 100,
              "attached_condition": "trigcond(a.artist_id = 1 or b.band_id = 1) and trigcond(trigcond(pf.band_id is not null))"
            }
          }
        ]
      }
    }
  }
}


------------------------------------------------------



{
  "query_block": {
    "select_id": 1,
    "cost": 0.32187848,
    "filesort": {
      "sort_key": "coalesce(a.`name`,b.`name`), case when a.artist_id is not null then 'Artist' else 'Band' end",
      "temporary_table": {
        "nested_loop": [
          {
            "table": {
              "table_name": "pf",
              "access_type": "ALL",
              "possible_keys": ["PRIMARY"],
              "loops": 1,
              "rows": 64,
              "cost": 0.0212868,
              "filtered": 100
            }
          },
          {
            "table": {
              "table_name": "p",
              "access_type": "ref",
              "possible_keys": ["idx_performance_performs_id"],
              "key": "idx_performance_performs_id",
              "key_length": "4",
              "used_key_parts": ["performs_id"],
              "ref": ["festival_database.pf.performs_id"],
              "loops": 64,
              "rows": 1,
              "cost": 0.06311712,
              "filtered": 100,
              "using_index": true
            }
          },
          {
            "table": {
              "table_name": "r",
              "access_type": "ref",
              "possible_keys": ["idx_rating_performance_id"],
              "key": "idx_rating_performance_id",
              "key_length": "4",
              "used_key_parts": ["performance_id"],
              "ref": ["festival_database.p.performance_id"],
              "loops": 64,
              "rows": 1,
              "cost": 0.11812864,
              "filtered": 100
            }
          },
          {
            "table": {
              "table_name": "a",
              "access_type": "const",
              "possible_keys": ["PRIMARY", "idx_artist_id"],
              "key": "PRIMARY",
              "key_length": "4",
              "used_key_parts": ["artist_id"],
              "ref": ["const"],
              "loops": 64,
              "rows": 1,
              "cost": 0.05967296,
              "filtered": 100,
              "attached_condition": "trigcond(trigcond(pf.artist_id = 1))"
            }
          },
          {
            "table": {
              "table_name": "b",
              "access_type": "const",
              "possible_keys": ["PRIMARY", "idx_band_id"],
              "key": "PRIMARY",
              "key_length": "4",
              "used_key_parts": ["band_id"],
              "ref": ["const"],
              "loops": 64,
              "rows": 1,
              "cost": 0.05967296,
              "filtered": 100,
              "attached_condition": "trigcond(trigcond(pf.band_id = 1))"
            }
          }
        ]
      }
    }
  }
}



---------------------

{
  "query_block": {
    "select_id": 1,
    "cost": 0.0670924,
    "having_condition": "count(0) > 2",
    "filesort": {
      "sort_key": "a.artist_id, f.festival_id",
      "temporary_table": {
        "nested_loop": [
          {
            "table": {
              "table_name": "e",
              "access_type": "ALL",
              "possible_keys": ["PRIMARY", "festival_id"],
              "loops": 1,
              "rows": 7,
              "cost": 0.0119958,
              "filtered": 100
            }
          },
          {
            "table": {
              "table_name": "f",
              "access_type": "eq_ref",
              "possible_keys": ["PRIMARY"],
              "key": "PRIMARY",
              "key_length": "4",
              "used_key_parts": ["festival_id"],
              "ref": ["festival_database.e.festival_id"],
              "loops": 7,
              "rows": 1,
              "cost": 0.00708028,
              "filtered": 100
            }
          },
          {
            "table": {
              "table_name": "perf",
              "access_type": "ref",
              "possible_keys": ["event_id", "idx_performance_performs_id"],
              "key": "event_id",
              "key_length": "4",
              "used_key_parts": ["event_id"],
              "ref": ["festival_database.e.event_id"],
              "loops": 7,
              "rows": 2,
              "cost": 0.0213336,
              "filtered": 100,
              "attached_condition": "lcase(perf.type_of_performance) = 'warm up'"
            }
          },
          {
            "table": {
              "table_name": "p",
              "access_type": "eq_ref",
              "possible_keys": ["PRIMARY", "idx_performs_artist_id"],
              "key": "PRIMARY",
              "key_length": "4",
              "used_key_parts": ["performs_id"],
              "ref": ["festival_database.perf.performs_id"],
              "loops": 14,
              "rows": 1,
              "cost": 0.01334136,
              "filtered": 100,
              "attached_condition": "p.artist_id is not null"
            }
          },
          {
            "table": {
              "table_name": "a",
              "access_type": "eq_ref",
              "possible_keys": ["PRIMARY", "idx_artist_id"],
              "key": "PRIMARY",
              "key_length": "4",
              "used_key_parts": ["artist_id"],
              "ref": ["festival_database.p.artist_id"],
              "loops": 14,
              "rows": 1,
              "cost": 0.01334136,
              "filtered": 100
            }
          }
        ]
      }
    }
  }
}


--
{
  "query_block": {
    "select_id": 1,
    "cost": 0.0670924,
    "having_condition": "count(0) > 2",
    "filesort": {
      "sort_key": "a.artist_id, f.festival_id",
      "temporary_table": {
        "nested_loop": [
          {
            "table": {
              "table_name": "e",
              "access_type": "ALL",
              "possible_keys": ["PRIMARY", "festival_id"],
              "loops": 1,
              "rows": 7,
              "cost": 0.0119958,
              "filtered": 100
            }
          },
          {
            "table": {
              "table_name": "f",
              "access_type": "eq_ref",
              "possible_keys": ["PRIMARY"],
              "key": "PRIMARY",
              "key_length": "4",
              "used_key_parts": ["festival_id"],
              "ref": ["festival_database.e.festival_id"],
              "loops": 7,
              "rows": 1,
              "cost": 0.00708028,
              "filtered": 100
            }
          },
          {
            "table": {
              "table_name": "perf",
              "access_type": "ref",
              "possible_keys": [
                "idx_performance_performs_id",
                "idx_performance_event_id"
              ],
              "key": "idx_performance_event_id",
              "key_length": "4",
              "used_key_parts": ["event_id"],
              "ref": ["festival_database.e.event_id"],
              "loops": 7,
              "rows": 2,
              "cost": 0.0213336,
              "filtered": 100,
              "attached_condition": "lcase(perf.type_of_performance) = 'warm up'"
            }
          },
          {
            "table": {
              "table_name": "p",
              "access_type": "eq_ref",
              "possible_keys": ["PRIMARY", "idx_performs_artist_id"],
              "key": "PRIMARY",
              "key_length": "4",
              "used_key_parts": ["performs_id"],
              "ref": ["festival_database.perf.performs_id"],
              "loops": 14,
              "rows": 1,
              "cost": 0.01334136,
              "filtered": 100,
              "attached_condition": "p.artist_id is not null"
            }
          },
          {
            "table": {
              "table_name": "a",
              "access_type": "eq_ref",
              "possible_keys": ["PRIMARY", "idx_artist_id"],
              "key": "PRIMARY",
              "key_length": "4",
              "used_key_parts": ["artist_id"],
              "ref": ["festival_database.p.artist_id"],
              "loops": 14,
              "rows": 1,
              "cost": 0.01334136,
              "filtered": 100
            }
          }
        ]
      }
    }
  }
}